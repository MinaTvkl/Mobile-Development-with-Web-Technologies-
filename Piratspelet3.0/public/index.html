<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <link type="text/css" rel="stylesheet" href="css.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="https://unpkg.com/onsenui/css/onsenui.css">
    <link rel="stylesheet" href="https://unpkg.com/onsenui/css/onsen-css-components.min.css">
    <script src="https://unpkg.com/onsenui/js/onsenui.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <meta charset="utf-8" />
    <title>Pirate Game, ARRRGH</title>
<!--Inlog firebase-->
<script src="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.js"></script>
<link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.css" />

    <!-- update the version number as needed -->
<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/7.14.3/firebase-app.js"></script>


<script defer src="https://www.gstatic.com/firebasejs/7.14.2/firebase-auth.js"></script>
<script defer src="https://www.gstatic.com/firebasejs/7.14.2/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.14.2/firebase-database.js"></script>


<script defer src="./init-firebase.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.14.3/firebase-analytics.js"></script>

<!-- initialize the SDK after all desired features are loaded -->
<script defer src="signinscript.js"></script>
<script defer src="./cardfunctions.js"></script>
<script defer src="./addfunctions.js"></script>
<script src="script.js"></script>
<script src="mapsscript.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCxuXYlxmbsxvPR1YOyCuNUPu9cBqj3FGk&callback=initMap" async defer></script>  
<script>
    
      var myVar;
      
      function loadThemap() {
        myVar = setTimeout(showPage, 3000);
      }
      
      
      function showPage() {
        document.getElementById("loader").style.display = "none";
        document.getElementById("intro").style.display = "none";
        document.getElementById("myDiv").style.display = "block";
        initMap();
      }
    </script>
    <script>
      
    var showTemplateDialog = function() {
        var dialog = document.getElementById('my-dialog');
      
        if (dialog) {
          dialog.show();
        } else {
          ons.createElement('dialog.html', { append: true })
            .then(function(dialog) {
              dialog.show();
            });
        }
      };
      
      var hideDialog = function(id) {
        document
          .getElementById(id)
          .hide();
      };
    </script>

    <script>
    window.fn = {};

    window.fn.open = function() {
        var menu = document.getElementById('menu');
        menu.open();
    };

    window.fn.load = function(page) {
        var content = document.getElementById('content');
        var menu = document.getElementById('menu');
        content.load(page)
            .then(menu.close.bind(menu));
    };
        
    </script>
      <script>
        // Your web app's Firebase configuration
        var firebaseConfig = {
          "projectId": "piratspelet-6afa4",
          "appId": "1:826621460800:web:5f6ae243fd28c504dfbaa5",
          "databaseURL": "https://piratspelet-6afa4.firebaseio.com",
          "storageBucket": "piratspelet-6afa4.appspot.com",
          "locationId": "europe-west",
          "apiKey": "AIzaSyA84Ze_Y2Yy0aoKI835N9Ss_8IthGt-53c",
          "authDomain": "piratspelet-6afa4.firebaseapp.com",
          "messagingSenderId": "826621460800",
          "measurementId": "G-CHDR97KN64"
        };
    
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const pirateName1 = ["Blå", "Röd", "Stor", "Rynk", "Lill"];
        const pirateName2 = ["Tand", "Tå", "Fot", "Hår", "Öga"];

        var max = 100;
        var min = 500;

        var pirateName = "Kapten " + pirateName1[Math.floor(Math.random() * pirateName1.length)] + "-" + pirateName2[Math.floor(Math.random() * pirateName2.length)] + Math.floor(Math.random() * (max) + min); 
    console.log("Random  Generated : " + pirateName);
        
      </script>
</head>
<body onload="loadThemap()">
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    

    <ons-toolbar id="header">
      
        <div class="left">

        </div>
        <div class="center">
          PIRATSPELET </div>
        <div class="right">
            <ons-toolbar-button icon="ion-navicon" onclick="firebase.auth().signOut()">Logga ut</ons-toolbar-button>
          </div>
    </ons-toolbar>
  
      <ons-page>
        <ons-tabbar swipeable position="auto" id="header">
          <ons-tab page="sign-in.html" label="Logga in" icon="md-home" id="sign-in">
          </ons-tab>
          <ons-tab page="play.html" label="Spela" icon="md-home" id="play">
          </ons-tab>
          <ons-tab page="maps.html" label="Karta" icon="md-settings" active-icon="md-face" id="map">
          </ons-tab>
        <ons-tab page="page5.html" label="Bidra" icon="md-settings" active-icon="md-face" id="settings">
        </ons-tab>
        <ons-tab page="chat.html" label="Flaskpost" icon="md-settings" active-icon="md-face" id="chat">
        </ons-tab>
        </ons-tabbar>
      </ons-page>

      <template id="sign-in.html">
        <ons-page id="sign-in">
          <ons-toolbar>
            <div class="left">
            </div>
        </ons-toolbar >

        <div classname="signInDivider">
          <div id="firebaseui-auth-container"> </div>
          <div id="loader_signin">Loading...</div>
          
        </div>
        </ons-page>

    </template>      
      <template id="play.html">
        <ons-page id="playcard">
            <div class="playcard" id="playcard" onclick="getcard()" onload="read()">
                <h1>Aaaaaargh!</h1>
                <p class="cardtext" id="cardtext"> </p>
            </div>
            
        </ons-page>

    </template>
    <script>
      $('#myModal').on('shown.bs.modal', function () {
      $('#myInput').trigger('focus')
    })
    </script>
    
    <template id="maps.html" >
      <ons-page id="page3">
        
          <ons-toolbar>
            
              <div class="left">
              </div>
              <div class="center" >MAP</div>
              
          </ons-toolbar >
        
          <div classname="mapdivider">
            <div id="intro" >
              <h1>Welcome to our map app</h1>
              <div id="loader"></div>
            </div>
            <div id="myDiv" style="display:none;">
              <div id="googlemap"></div>
              <div id="controlWrapper">
                <div class ="Locationbuttons">
                 
                  <form onsubmit="return postMyLocation();" style="padding-bottom: 10px;">
                    <h>Dela din position</h>
                    <input id="messageForLocation" placeholder="Beskriv vart du är" autocomplete="on">
                    <input type="submit"></form>
                  </form>
                  <button class ="Locationbutton" id="getOthersLocation" onClick="getOthersLocations()">Visa vart andra sitter</button>
                </div>
              </div>
        
                <div class ="zoombuttons">
                  <button class= "zoombutton" id="zoomInButton" >+</button>
                  <button class= "zoombutton" id="zoomOutButton" >-</button>
                </div>
              
            </div>
          </div>

          
          
      </ons-page>
      
    </template>

    <template id="page5.html">
        <ons-page id="page5">
            <ons-toolbar>
                <div class="left">
                </div>
                <div class="center">Settings</div>
            </ons-toolbar>
            <div class="my-content">
                <h1>Skepp ohoj, lägg till ett kort</h1>
                <form>
                  <div class="form-group">
                    <label for="exampleInputEmail1">Fyll i ditt kort här</label>
                    <textarea class="form-control" id="cardinput" rows="3"></textarea>
                  </div>
                  <button type="reset" class="btn btn-success" onclick="writeNewPost()">Lägg till kort</button>
                </form>
            </div>
            <ons-list>
        </ons-page>
    </template>
    <template id="chat.html">
      <ons-page id="chat">
        <ons-toolbar>
          <div class="left">
          </div>
          <div class="center">Message in a bottle</div>
        </ons-toolbar>
        <div class="my-content">
          <!-- create a form to send message -->
          <form onsubmit="return sendMessage();">
            <input id="message" placeholder="Enter message" autocomplete="on">
  
            <input type="submit">
          </form>
          <!-- create a list -->
          <ul id="messages"></ul>
        </div>
        <ons-list>
      </ons-page>
    </template>
  
  
  
    <script>
      function sendMessage() {
        // get message
        var message = document.getElementById("message").value;
  
        // save in database
        firebase.database().ref("messages").push().set({
          "sender": pirateName,
          "message": message
        });
  
        // prevent form from submitting
        return false;
      }
    </script>
  
    <script>
      // listen for incoming messages
      firebase.database().ref("messages").on("child_added", function (snapshot) {
        var html = "";
        // give each message a unique ID
        html += "<li id='message-" + snapshot.key + "'>";
        // show delete button if message is sent by me
        if (snapshot.val().sender == pirateName) {
          html += "<button data-id='" + snapshot.key + "' onclick='deleteMessage(this);'>";
          html += "Ta bort";
          html += "</button>";
        }
        html += snapshot.val().sender + ": " + snapshot.val().message;
        html += "</li>";
  
        document.getElementById("messages").innerHTML += html;
      });
  
  
      // attach listener for delete message
      firebase.database().ref("messages").on("child_removed", function (snapshot) {
        // remove message node
        document.getElementById("message-" + snapshot.key).innerHTML = "This message has been removed";
      });
  
      function deleteMessage(self) {
        // get message ID
        var messageId = self.getAttribute("data-id");
  
        // delete message
        firebase.database().ref("messages").child(messageId).remove();
      }
  
      // attach listener for delete message
      firebase.database().ref("messages").on("child_removed", function (snapshot) {
        // remove message node
        document.getElementById("message-" + snapshot.key).innerHTML = "Flaskposten sjönk :(";
      });
    </script>
  

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // // 🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
        // // The Firebase SDK is initialized and available here!
        //
        // firebase.auth().onAuthStateChanged(user => { });
        // firebase.database().ref('/path/to/ref').on('value', snapshot => { });
        // firebase.messaging().requestPermission().then(() => { });
        // firebase.storage().ref('/path/to/ref').getDownloadURL().then(() => { });
        //
        // // 🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

        try {
          let app = firebase.app();
          let features = ['auth', 'database', 'messaging', 'storage'].filter(feature => typeof app[feature] === 'function');
          document.getElementById('load').innerHTML = `Firebase SDK loaded with ${features.join(', ')}`;
        } catch (e) {
          console.error(e);
          document.getElementById('load').innerHTML = 'Error loading the Firebase SDK, check the console.';
        }
    });



    </script>

<script>


function writeUserData() {
  var starCountRef = firebase.database().ref('cards/');
    starCountRef.on('value', function(snapshot) {
      var length = snapshot.val().length
      console.log(length)
      firebase.database().ref('cards/').set({
      length: "hej"
    });
  });
}


</script>
    
</body>
  
</html>